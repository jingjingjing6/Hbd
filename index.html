<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Birthday Animation - Vertical Mode</title>
<style>
  :root {
    --bg: white;
    --text: #000;
    --bubble-bg: #ffffff;
    --bubble-bg-alt: #fff7a8;
    --bubble-color: #000;
  }
  html, body {
    margin: 0; padding: 0; height: 100%;
    background: #111;
    font-family: -apple-system, "Helvetica Neue", Arial, "Noto Sans SC", "PingFang SC", "Hiragino Sans GB", "Microsoft Yahei", sans-serif;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    overflow: hidden;
    color: var(--text);
  }

  /* é¦–é¡µæ–‡æœ¬å®¹å™¨ï¼Œç«–å±ä¸­é—´å±…ä¸­ */
  #homeScreen {
    height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    background: white;
    color: black;
    font-weight: 800;
    font-size: 48px;
    user-select: none;
    overflow: visible;
    position: relative;
  }

  #loadingCanvas {
    position: relative;
    width: 90vw;
    height: 40vh;
    max-width: 380px;
    max-height: 180px;
    margin: 0 auto;
    overflow: visible;
  }

  /* ç‚¹é˜µå—tileï¼Œå¤§å°å›ºå®šï¼Œä¸é‡å  */
  .pixel {
    position: absolute;
    width: 26px;
    height: 26px;
    background-image: url('image4.png');
    background-size: contain;
    background-repeat: no-repeat;
    opacity: 0;
    transform: translateY(-6px);
    transition: opacity 0.18s linear, transform 0.18s ease;
    pointer-events: none;
  }

  /* ä¸»èˆå°ï¼Œåç»­åŠ¨ç”»åŒºåŸŸ */
  #stage {
    display: none;
    height: 100vh;
    background: white;
    position: relative;
    overflow: hidden;
    color: var(--text);
  }

  /* image2å®¹å™¨ï¼ŒèƒŒæ™¯ç™½è‰²ï¼Œå›¾ç‰‡ä¸æ‹‰ä¼¸ï¼Œå±…ä¸­ */
  #image2Wrap {
    background: white;
    position: relative;
    width: 100%;
    height: 50vh;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  #image2 {
    max-width: 90%;
    max-height: 100%;
    object-fit: none;
  }

  /* image3èƒŒæ™¯ç™½è‰²ï¼Œå›¾ç‰‡è‡ªç„¶å¤§å°ï¼Œå±…ä¸­ */
  #image3Wrap {
    background: white;
    position: relative;
    height: 40vh;
    width: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  #image3 {
    max-height: 100%;
    max-width: 90%;
    object-fit: none;
    opacity: 0;
    transition: opacity 0.8s ease-in-out;
    pointer-events: none;
  }

  /* image1èƒŒæ™¯å…¨å±ï¼Œæ»‘å…¥åŠ¨ç”» */
  #image1bg {
    position: absolute;
    inset: 0;
    background-image: url('image1.jpg');
    background-position: center;
    background-repeat: no-repeat;
    background-size: contain;
    transform: translateX(100%);
    transition: transform 1.6s ease-in-out;
    z-index: 1;
  }

  /* æ°”æ³¡å®¹å™¨å’Œæ°”æ³¡æ ·å¼ */
  #bubbles {
    position: absolute;
    left: 5%;
    bottom: 33%;
    width: 60%;
    display: flex;
    flex-direction: column;
    gap: 12px;
    z-index: 5;
    pointer-events: none;
  }
  .bubble {
    max-width: 100%;
    display: inline-block;
    padding: 12px 14px;
    border-radius: 18px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
    opacity: 0;
    transform: translateY(8px);
    transition: opacity 0.6s ease, transform 0.6s ease;
    word-break: break-word;
    font-size: 15px;
    line-height: 1.4;
  }
  .bubble.show {
    opacity: 1;
    transform: translateY(0);
  }
  .bubble.white {
    background: var(--bubble-bg);
    color: var(--bubble-color);
  }
  .bubble.yellow {
    background: var(--bubble-bg-alt);
    color: var(--bubble-color);
  }

  /* æœ€ç»ˆxDè¯„åˆ†å±å¹• */
  #finalXDScreen {
    background: #000;
    color: #fff;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    gap: 14px;
    font-size: 48px;
    z-index: 9;
    height: 100vh;
    user-select: none;
  }
  #pleaseRate {
    font-size: 18px;
    margin-top: 6px;
    display: none;
  }
  #stars {
    font-size: 34px;
    letter-spacing: 6px;
    cursor: pointer;
    user-select: none;
    display: none;
  }
  .star {
    display: inline-block;
    transition: transform 0.12s ease;
  }
  .star:hover {
    transform: translateY(-4px);
  }

  /* æ„Ÿè°¢é¡µé¢ */
  #thanksPage {
    background: #000;
    color: #fff;
    display: none;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding: 20px;
    box-sizing: border-box;
    font-size: 20px;
    line-height: 1.4;
    height: 100vh;
    user-select: none;
  }

  /* emoji ä¸‹è½æ•ˆæœ */
  .emoji-fall {
    position: absolute;
    top: -40px;
    font-size: 22px;
    pointer-events: none;
    animation-name: fall;
    animation-timing-function: linear;
    animation-iteration-count: infinite;
  }
  @keyframes fall {
    to {
      transform: translateY(720px) rotate(360deg);
      opacity: 0.05;
    }
  }

  @media (max-width: 420px) {
    .pixel {
      width: 20px;
      height: 20px;
    }
    #homeScreen {
      font-size: 36px;
    }
    #finalXDScreen {
      font-size: 38px;
    }
    #stars {
      font-size: 26px;
    }
  }
</style>
</head>
<body>

  <!-- é¦–é¡µæ–‡æœ¬ï¼Œç‚¹é˜µåŠ¨ç”» -->
  <div id="homeScreen" aria-label="è¯·ç­‰å¾…åŠ è½½">
    <div id="loadingCanvas" aria-hidden="true"></div>
  </div>

  <!-- ä¸»èˆå°ï¼ˆåç»­åŠ¨ç”»ï¼‰ -->
  <div id="stage" aria-hidden="true">

    <!-- image2 åŒºåŸŸ -->
    <div id="image2Wrap">
      <img id="image2" src="image2.jpg" alt="ç¥ç¦å›¾ç‰‡" />
    </div>

    <!-- loading scene éšè—ï¼Œæš‚ä¸éœ€è¦ -->
    <div id="loadingScene" class="scene hidden" aria-hidden="true">
      <div id="loadingCanvas2" aria-hidden="true"></div>
      <div id="loadingTextLabel">loading...</div>
    </div>

    <!-- image3 åŒºåŸŸ -->
    <div id="image3Wrap">
      <img id="image3" src="image3.png" alt="ç®­å¤´" />
    </div>

    <!-- image1 èƒŒæ™¯ï¼Œæ»‘å…¥ -->
    <div id="image1bg"></div>

    <!-- æ°”æ³¡ -->
    <div id="bubbles"></div>

    <!-- æœ€ç»ˆxDè¯„åˆ†å±å¹• -->
    <div id="finalXDScreen" class="scene hidden" aria-hidden="true">
      <div id="xDText" style="font-weight: 800;">xD</div>
      <div id="pleaseRate">please rate</div>
      <div id="stars" aria-label="rating">
        <span class="star" data-value="1">â˜†</span>
        <span class="star" data-value="2">â˜†</span>
        <span class="star" data-value="3">â˜†</span>
        <span class="star" data-value="4">â˜†</span>
        <span class="star" data-value="5">â˜†</span>
      </div>
    </div>

    <!-- æ„Ÿè°¢é¡µé¢ -->
    <div id="thanksPage" class="scene" aria-hidden="true">
      <div style="white-space: pre-line; font-weight: 600;">
        thanks for your 5 star
        ï¼ˆknew you would do this xD love you looots
      </div>
    </div>

  </div>

<script>
(() => {
  // é…ç½®é¡¹
  const PIXEL_SIZE = 26;        // ç‚¹é˜µå—å¤§å°ï¼ˆå’Œcssä¿æŒä¸€è‡´ï¼‰
  const PIXEL_GAP = PIXEL_SIZE + 4; // é—´éš”ï¼Œä¿è¯ä¸é‡å 
  const REPEAT_COUNT = 2;       // å­—æ ·é‡å¤æ¬¡æ•°ï¼ˆæ¨ªå‘é‡å¤ï¼‰
  const TEXT = "HBDï¼ï¼ï¼";     // é¦–é¡µæ˜¾ç¤ºæ–‡æœ¬
  const CANVAS_WIDTH = 380;     // canvaså¤§å°ï¼Œå’Œcssæœ€å¤§å®½åº¦å¯¹é½
  const CANVAS_HEIGHT = 180;

  // å…ƒç´ 
  const homeScreen = document.getElementById("homeScreen");
  const loadingCanvas = document.getElementById("loadingCanvas");
  const stage = document.getElementById("stage");
  const image2 = document.getElementById("image2");
  const image2Wrap = document.getElementById("image2Wrap");
  const image3 = document.getElementById("image3");
  const image3Wrap = document.getElementById("image3Wrap");
  const image1bg = document.getElementById("image1bg");
  const bubblesWrap = document.getElementById("bubbles");
  const finalXDScreen = document.getElementById("finalXDScreen");
  const pleaseRate = document.getElementById("pleaseRate");
  const stars = document.getElementById("stars");
  const thanksPage = document.getElementById("thanksPage");

  // loadingCanvaså®¹å™¨å¤§å°ï¼Œç”¨æ¥å®šä½pixel
  loadingCanvas.style.width = CANVAS_WIDTH + "px";
  loadingCanvas.style.height = CANVAS_HEIGHT + "px";
  loadingCanvas.style.position = "relative";

  // åˆ›å»ºç”¨äºæ¸²æŸ“æ–‡æœ¬çš„canvasï¼ˆä¸æ”¾é¡µé¢ï¼Œä»…ç”¨äºé‡‡æ ·ï¼‰
  const canvas = document.createElement("canvas");
  canvas.width = CANVAS_WIDTH;
  canvas.height = CANVAS_HEIGHT;
  const ctx = canvas.getContext("2d");
  ctx.font = "bold 120px sans-serif";
  ctx.textBaseline = "middle";
  ctx.fillStyle = "#000";

  // ç”Ÿæˆæ–‡æœ¬å›¾åƒï¼Œé‡å¤ä¸¤æ¬¡æ–‡å­— æ¨ªå‘æ‹¼æ¥ï¼Œä¸­é—´ç•™ç©º
  const textXOffset = 8;
  const textYOffset = CANVAS_HEIGHT / 2;
  ctx.clearRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);

  // ç”»ä¸¤éæ–‡æœ¬ï¼Œä¸­é—´é—´éš”è¾ƒå¤§
  const repeatText = TEXT + "   " + TEXT;
  ctx.fillText(repeatText, textXOffset, textYOffset);

  // é‡‡æ ·é˜ˆå€¼ï¼Œalpha>128è®¤ä¸ºæœ‰ç‚¹
  const ALPHA_THRESHOLD = 128;

  // é‡‡æ ·ç‚¹ä½ç½®é›†åˆ
  const pixelPositions = [];

  // é‡‡æ ·é—´éš”ä¸º PIXEL_GAP ä¿è¯ä¸ä¼šé‡å 
  for (let y = 0; y < CANVAS_HEIGHT; y += PIXEL_GAP) {
    for (let x = 0; x < CANVAS_WIDTH; x += PIXEL_GAP) {
      const data = ctx.getImageData(x, y, 1, 1).data;
      // dataæ˜¯rgbaï¼Œåˆ¤å®šalphaå’Œé»‘è‰²åƒç´ 
      if (data[3] > ALPHA_THRESHOLD && data[0] < 128 && data[1] < 128 && data[2] < 128) {
        pixelPositions.push({ x, y });
      }
    }
  }

  // ä¾æ¬¡åˆ›å»ºpixelå…ƒç´ ï¼Œå»¶è¿Ÿé€ä¸ªå‡ºç°
  async function showPixelsSequentially() {
    loadingCanvas.innerHTML = "";
    for (let i = 0; i < pixelPositions.length; i++) {
      const pos = pixelPositions[i];
      const el = document.createElement("div");
      el.className = "pixel";
      el.style.width = PIXEL_SIZE + "px";
      el.style.height = PIXEL_SIZE + "px";
      el.style.left = pos.x + "px";
      el.style.top = pos.y + "px";
      loadingCanvas.appendChild(el);

      // å»¶è¿Ÿæ˜¾ç¤ºï¼Œä¿è¯ç‚¹é˜µä¾æ¬¡ä»ä¸Šåˆ°ä¸‹ã€å·¦åˆ°å³å‡ºç°
      await new Promise((r) => setTimeout(r, 20));

      el.style.opacity = "1";
      el.style.transform = "translateY(0)";
    }
  }

  // åºåˆ—æ˜¾ç¤ºç‚¹é˜µï¼Œç„¶ååˆ‡æ¢åˆ°åç»­åŠ¨ç”»
  async function runSequence() {
    // æ˜¾ç¤ºé¦–é¡µç‚¹é˜µæ–‡å­—
    await showPixelsSequentially();

    // ä¿æŒä¸€ç‚¹åœé¡¿åè¿›å…¥åç»­åŠ¨ç”»
    await new Promise((r) => setTimeout(r, 1200));

    // éšè—é¦–é¡µï¼Œæ˜¾ç¤ºä¸»èˆå°
    homeScreen.style.display = "none";
    stage.style.display = "block";
    stage.setAttribute("aria-hidden", "false");

    // æ˜¾ç¤º image2ï¼Œç¡®ä¿åŠ è½½å®Œæˆ
    image2.style.opacity = "1";
    image2.style.transition = "opacity 1s ease-in-out";
    await ensureImageLoaded(image2);

    // æ˜¾ç¤º image3
    image3.style.opacity = "1";

    // ç­‰å¾… 3ç§’å image3 æ¸éš
    await new Promise((r) => setTimeout(r, 3000));
    image3.style.opacity = "0";

    // ç­‰å¾…æ¸éšå®Œæˆ
    await new Promise((r) => setTimeout(r, 800));

    // image1 èƒŒæ™¯æ»‘å…¥
    image1bg.style.transform = "translateX(0)";
    await new Promise((r) => setTimeout(r, 1600));

    // æ˜¾ç¤ºæ°”æ³¡
    await showBubbles();

    // åœé¡¿
    await new Promise((r) => setTimeout(r, 8000));

    // æ˜¾ç¤ºxDè¯„åˆ†é¡µé¢
    finalXDScreen.classList.remove("hidden");
    finalXDScreen.style.display = "flex";

    await new Promise((r) => setTimeout(r, 3000));

    pleaseRate.style.display = "block";
    stars.style.display = "block";
    attachStarHandlers();
  }

  // ç¡®ä¿å›¾ç‰‡åŠ è½½å®Œæˆ
  function ensureImageLoaded(img) {
    return new Promise((resolve) => {
      if (img.complete && img.naturalWidth !== 0) return resolve();
      img.onload = () => resolve();
      img.onerror = () => resolve();
    });
  }

  // æ°”æ³¡æ–‡æœ¬
  const messages = [
    "Heyyy Ahmed, happy birthday to you!ğŸ¥³",
    "If I could give you something today, it would be a quiet moment where nothing hurts and presses you",
    "I see how much youâ€™re carrying, and I respect you for that!",
    "I hope this year brings you more ease so that you can breathe. ğŸ«‚",
    "Remember! You can always be yourself with me! Lots of love!ğŸ¥°",
  ];

  // é¡ºåºæ˜¾ç¤ºæ°”æ³¡
  async function showBubbles() {
    bubblesWrap.innerHTML = "";
    for (let i = 0; i < messages.length; i++) {
      const el = document.createElement("div");
      el.className = "bubble " + (i % 2 === 0 ? "white" : "yellow");
      el.textContent = messages[i];
      bubblesWrap.appendChild(el);
      await new Promise((r) => setTimeout(r, 120));
      el.classList.add("show");
      await new Promise((r) => setTimeout(r, 5000));
    }
  }

  // è¯„åˆ†æ˜Ÿæ˜Ÿé€»è¾‘
  function attachStarHandlers() {
    const starEls = Array.from(document.querySelectorAll("#stars .star"));
    starEls.forEach((s) => {
      s.addEventListener("click", () => {
        const val = parseInt(s.dataset.value || "1", 10);
        fillStars(val);
        if (val === 5) {
          setTimeout(() => {
            finalXDScreen.style.display = "none";
            thanksPage.style.display = "flex";
          }, 600);
        }
      });
      s.addEventListener("mouseover", () => {
        const v = parseInt(s.dataset.value, 10);
        fillStars(v);
      });
      s.addEventListener("mouseout", () => {
        const filled = document.querySelectorAll("#stars .star.filled").length;
        fillStars(filled);
      });
    });
  }
  function fillStars(count) {
    const starEls = Array.from(document.querySelectorAll("#stars .star"));
    starEls.forEach((st, idx) => {
      if (idx < count) {
        st.textContent = "â­";
        st.classList.add("filled");
      } else {
        st.textContent = "â˜†";
        st.classList.remove("filled");
      }
    });
  }

  // å¯åŠ¨åŠ¨ç”»æµç¨‹
  runSequence();
})();
</script>

</body>
</html>
